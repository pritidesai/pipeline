# Task producing failure by exiting with 1
apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: failure-task
spec:
  steps:
    - name: fail
      image: ubuntu
      script: exit 1
---

# Task producing success by exiting with 0
apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: successful-task
spec:
  steps:
    - name: success
      image: ubuntu
      script: exit 0
---

# Condition which is always true
apiVersion: tekton.dev/v1alpha1
kind: Condition
metadata:
  name: true-condition
spec:
  params:
    - name: "foo"
  check:
    image: alpine
    script: 'test foo'
---

# Condition which is always false
apiVersion: tekton.dev/v1alpha1
kind: Condition
metadata:
  name: false-condition
spec:
  params:
    - name: "foo"
  check:
    image: alpine
    script: 'test ! foo'
---

#  Pipeline:
#         task1
#           | failure
#         task2
#           | failure
#         task3
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-single-branch-three-tasks-failure-failure
spec:
  tasks:
    - name: task1
      taskRef:
        Name: failure-task
    - name: task2
      taskRef:
        Name: failure-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - failure
    - name: task3
      taskRef:
        Name: successful-task
      runAfter:
        - task2
      runOn:
        - task: task2
          states:
            - failure
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-single-branch-three-tasks-failure-failure
spec:
  pipelineRef:
    name: pipeline-single-branch-three-tasks-failure-failure
---

# Pipeline:
#         task1
#           | failure
#         task2
#           | success
#         task3
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-single-branch-three-tasks-failure-success
spec:
  tasks:
    - name: task1
      taskRef:
        Name: failure-task
    - name: task2
      taskRef:
        Name: successful-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - failure
    - name: task3
      taskRef:
        Name: successful-task
      runAfter:
        - task2
      runOn:
        - task: task2
          states:
            - success
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-single-branch-three-tasks-failure-success
spec:
  pipelineRef:
    name: pipeline-single-branch-three-tasks-failure-success
---

# Pipeline:
#         task1
#           | success
#         task2
#           | failure
#         task3
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-single-branch-three-tasks-success-failure
spec:
  tasks:
    - name: task1
      taskRef:
        Name: successful-task
    - name: task2
      taskRef:
        Name: failure-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - success
    - name: task3
      taskRef:
        Name: successful-task
      runAfter:
        - task2
      runOn:
        - task: task2
          states:
            - failure
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-single-branch-three-tasks-success-failure
spec:
  pipelineRef:
    name: pipeline-single-branch-three-tasks-success-failure
---

#  Pipeline:
#         task1
#           | failure
#         task2
#           | failure
#         task3
#           | no runOn
#         task4
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-single-branch-four-tasks-failure-failure-norunon
spec:
  tasks:
    - name: task1
      taskRef:
        Name: failure-task
    - name: task2
      taskRef:
        Name: failure-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - failure
    - name: task3
      taskRef:
        Name: successful-task
      runAfter:
        - task2
      runOn:
        - task: task2
          states:
            - failure
    - name: task4
      taskRef:
        Name: successful-task
      runAfter:
        - task3 # task2 hangs waiting for all the tasks in the Pipeline to finish
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-single-branch-four-tasks-failure-failure-norunon
spec:
  pipelineRef:
    name: pipeline-single-branch-four-tasks-failure-failure-norunon
---

# Pipeline:
#             task1
#    success /     \ success
#         task2   task3
#   failure |       | success
#         task4   task5
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-two-branches-mix-of-success-failure
spec:
  tasks:
    - name: task1
      taskRef:
        Name: successful-task
    - name: task2
      taskRef:
        Name: failure-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - success
    - name: task3
      taskRef:
        Name: successful-task
      runAfter:
        - task1
      runOn:
        - task: task1
          states:
            - success
    - name: task4
      taskRef:
        Name: successful-task
      runAfter:
        - task2
      runOn:
        - task: task2
          states:
            - failure
    - name: task5
      taskRef:
        Name: successful-task
      runAfter:
        - task3
      runOn:
        - task: task3
          states:
            - success
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-two-branches-mix-of-success-failure
spec:
  pipelineRef:
    name: pipeline-two-branches-mix-of-success-failure
---

#  Pipeline:
#        condition
#           |
#         task1
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: pipeline-condition-failures
spec:
  params:
    - name: "foo"
      default: "foo"
  tasks:
    - name: task1
      taskRef:
        Name: successful-task
      conditions:
        - conditionRef: "false-condition"
          params:
            - name: "foo"
              value: "$(params.foo)"
---

apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: pipelinerun-condition-failures
spec:
  pipelineRef:
    name: pipeline-condition-failures
---
